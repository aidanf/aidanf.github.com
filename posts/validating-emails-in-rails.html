<!doctype html>
<html><!-- InstanceBegin template="/Templates/page-full-width.dwt" codeOutsideHTMLIsLocked="false" -->

<head>


    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
    <meta name="description" content="Aidan Finn's Website">
    <meta name="keywords" content="swift, clojure, ios, screencasts, book, python, ruby, machine learning, sligo">
    <meta name="author" content="Aidan Finn">

    <!-- InstanceBeginEditable name="doctitle" -->
    <title>
        Validating Emails in Rails (and other web frameworks) - /aidanf/
    </title>
    <!-- InstanceEndEditable -->

    <!-- FAV and TOUCH ICONS -->
    <link rel="shortcut icon" href="/favicon.ico">

    <!-- FONTS -->
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=UnifrakturMaguntia' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Coustard' rel='stylesheet' type='text/css'>

    <!--[if lte IE 9]>
        <script src="/js/html5shiv.js"></script>
        <script src="/js/selectivizr-min.js"></script>
    <![endif]-->

    <!-- STYLES -->
    <link rel="stylesheet" type="text/css" media="print" href="/css/print.css">
    <link rel="stylesheet" type="text/css" href="/css/grid.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="/css/uniform.default.css">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="/css/flexslider.css">

    <!-- SCRIPTS -->
    <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/js/jquery-1.8.3.min.js"><\/script>')</script>


    <!-- InstanceBeginEditable name="head" -->
	<!-- InstanceEndEditable -->

        
</head>

<body>

    <!-- #PAGE -->
    <div id="page" class="hfeed site">

      

<!-- .site-header -->
<header class="site-header wrapper" role="banner">

    <!-- .row -->
    <div class="row">

        <!-- .site-title -->
        <hgroup>
            <h1 class="site-title"><a href="/" title="/aidanf/" rel="home">/aidanf/</a></h1>
            <h2 class="site-description">musings of a curious coder</h2>
        </hgroup>
        <!-- .site-title -->

        <!-- #site-navigation -->
        <nav id="site-navigation" class="main-navigation" role="navigation">
            <ul>
                <li ><a href="/">Blog</a></li>
                <li ><a href="/learn-swift">Learn Swift</a></li>
                <li ><a href="/about">About</a></li>
            </ul>
        </nav>
        <!-- #site-navigation -->

    </div>
    <!-- .row -->
</header>
<!-- .site-header -->

      <!-- #main -->
      <section id="main" class="middle wrapper">
        <div class="row row-fluid">





                <!-- #primary -->
                <div id="primary" class="site-content">

                    <!-- #content -->
                    <div id="content" role="main">
                      <!-- InstanceBeginEditable name="Middle-Content" -->

<!-- .blog-single -->
<div class="blog-single readable-content">


    <!-- .hentry -->
    <article class="post type-post format-standard hentry">


        <!-- .entry-header -->
        <header class="entry-header">
            <h1 class="entry-title">Validating Emails in Rails (and other web frameworks)</h1>
        </header>
        <!-- .entry-header -->

        <!-- .entry-meta -->
        <div class="entry-meta">
            posted
            on <a href="#" title="11:15 pm" rel="bookmark">
            <time class="entry-date" datetime="2014-10-17T00:00:00+01:00">Oct 17, 2014
            </time>
        </a>

            <!-- .share-links -->
            <div class="share-links">
                <a>SHARE</a>

                <!-- .share-wrap -->
                <div class="share-wrap">

                    <!-- .facebook-wrap -->
                    <div class="facebook-wrap">

                        <div id="fb-root"></div>
                        <script>(function (d, s, id) {
                            var js, fjs = d.getElementsByTagName(s)[0];
                            if (d.getElementById(id)) return;
                            js = d.createElement(s);
                            js.id = id;
                            js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
                            fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));</script>
                        <div class="fb-like" data-send="false" data-layout="button_count" data-width="400"
                             data-show-faces="false" data-colorscheme="light" data-action="like"></div>

                    </div>
                    <!-- .facebook-wrap -->

                    <!-- .twitter-wrap -->
                    <div class="twitter-wrap">
                        <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
                        <script>!function (d, s, id) {
                            var js, fjs = d.getElementsByTagName(s)[0];
                            if (!d.getElementById(id)) {
                                js = d.createElement(s);
                                js.id = id;
                                js.src = "//platform.twitter.com/widgets.js";
                                fjs.parentNode.insertBefore(js, fjs);
                            }
                        }(document, "script", "twitter-wjs");</script>
                    </div>
                    <!-- .twitter-wrap -->

                    <!-- .google-wrap -->
                    <div class="google-wrap">
                        <!-- Place this tag where you want the +1 button to render. -->
                        <div class="g-plusone" data-size="medium"></div>

                        <!-- Place this tag after the last +1 button tag. -->
                        <script type="text/javascript">
                            (function () {
                                var po = document.createElement('script');
                                po.type = 'text/javascript';
                                po.async = true;
                                po.src = 'https://apis.google.com/js/plusone.js';
                                var s = document.getElementsByTagName('script')[0];
                                s.parentNode.insertBefore(po, s);
                            })();
                        </script>
                    </div>
                    <!-- .google-wrap -->

                    <!-- .pinterest-wrap -->
                    <div class="pinterest-wrap">
                        <a href="http://pinterest.com/pin/create/button/?url=http%3A%2F%2Fthemes.pixelwars.org%2Fread%2Fblog-single.html&media=http%3A%2F%2Fthemes.pixelwars.org%2Fread%2Fimages%2Fblog%2Fblog-01.jpg&description=Adaptive%20Vs.%20Responsive%20Layouts%20And%20Optimal%20Form%20Field%20Labels"
                           class="pin-it-button" count-layout="horizontal"><img
                                src="//assets.pinterest.com/images/PinExt.png" alt="Pin It" title="Pin It"/></a>
                        <script type="text/javascript" src="//assets.pinterest.com/js/pinit.js"></script>
                    </div>
                    <!-- .pinterest-wrap -->

                </div>
                <!-- .share-wrap -->


            </div>
            <!-- .share-links -->


        </div>
        <!-- .entry-meta -->


        <!-- .featured-image -->
        
        <!-- .featured-image -->


        <!-- .entry-content -->
        <div class="entry-content">
            <p>Validating emails is an apparently easy task that turns out to actually be quite&nbsp;difficult.</p><p>Early in your carreer as a rails developer you'll find yourself needing to validate email addresses on one of your models. Which is simple, right? It only takes one line.</p><pre class="source-code">validates :email, :format =&gt; /EMAIL_REGEX_GOES_HERE/

</pre><p>Now all you need to do is come up with a regex that allows all valid emails and rejects all invalid emails. Should me simple, right?</p><p>The first time I needed to validate an email address, I spent way too much time working on a regular expression. Eventually I came up with one that covered all the cases I though were valid and rejected the invalid ones I tested with. Feeling happy with my sexy regex, I deployed it, moved onto something else and never gave it another thought.</p><p>Then a few weeks later, I got an email from the client saying that one of their users couldn't create an account on the system. Turns out that emails can have all sorts of funky variations, some of which are part of the defined standard, some of which are not.</p><p>And so I learned something - there's something in the developer mindset that is bothered by the idea of people submitting invalid email addresses. The idea that &nbsp;my regex could allow some invalid cases through bothered me, and I enjoyed the puzzle of coming up with a regular expression that would validate my example email addresses.</p><p>But lets take a step back and think about the purpose of validating an email. The main thing you want to catch is the case when a user accidentally mistypes their email or doesn't realize that they need to provide an email (for example, they enter a name or username instead).</p><p>Your app is not the email police, sent out into the world to punish users who have invalid or unusual characters in their email address. You just want to gently nudge the user if they enter something that is obviously not an email address, and otherwise let them get on with it.</p><p><em>Rejecting a single users real email address is many times worse than allowing multiple invalid emails into your database</em>. You want to minimize false positives and who cares about false negatives.</p><p>And to that end, you don't really need a complicated regular expression. &nbsp;You just need one that recognizes when something vaguely along the lines of something@somewhere.someplace. And that's enough. If ensuring that your user enters a valid email is valid is important to your app, then send them a confirmation email. That's the only way to ensure they've entered their valid email address.</p><p>So, getting back to the technical details. What regex should we use to validate our emails? Lets look at a few common examples that I collected(sources are in the table below). We'll evaluate these regexes against this <a href="http://codefool.tumblr.com/post/15288874550/list-of-valid-and-invalid-email-addresses">list of valid and invalid emails</a>.</p><p>Here's a quick 'n' dirty script to check a few email validation regular expressions.</p><script src="https://gist.github.com/aidanf/2e7b8cbf6fecc2567f19.js"></script><p id="yui_3_17_2_7_1413371187242_12615">And here's the results:</p><table border="1" style="table-layout: fixed;word-break: break-all;" width="100%" cellpadding="3" cellspacing="3">
  	<tr>
    	<th width="40%">Regex</th>
	    <th style="word-break: normal;">Valid emails rejected (17)</th>
	    <th style="word-break: normal;">Invalid emails accepted (20)</th>
	    <th width="30%">Source</th>
	</tr>
	<tr>
	  	<td>/@/</td>
	  	<td>0</td>
	  	<td>18</td>
	  	<td></td>
	</tr>
	<tr>
	  	<td><code>/.+@.+\..+/i</code></td>
	  	<td>0</td>
	  	<td>16</td>
	  	<td><a href="http://davidcel.is/blog/2012/09/06/stop-validating-email-addresses-with-regex/">davidcel.is</a></td>
	</tr>
	<tr>
	  	<td><code>/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i</code></td>
	  	<td>5</td>
	  	<td>9</td>
	  	<td><a href="http://www.aidanf.net/posts/rails-authentication-tutorial">aidanf.net</a></a></td>
	</tr>
	<tr>
	  	<td><code>/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i</code></td>
	  	<td>5</td>
	  	<td>0</td>
	  	<td><a href="https://fightingforalostcause.net/content/misc/2006/compare-email-regex.php">fightingforalostcause.net</a></td>
	</tr>
	<tr>
	  	<td><code>/^([\w\.%\+\-]+)@([\w\-]+\.)+([\w]{2,})$/i</code></td>
	  	<td>5</td>
	  	<td>7</td>
	  	<td><a href="http://awesoham.wordpress.com/2013/10/02/a-simple-regex-for-rails-email-validation/">awesoham.wordpress.com</a></td>
	</tr>
	<tr>
	  	<td><code>/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</code></td>
	  	<td>6</td>
	  	<td>7</td>
	  	<td><a href="https://www.railstutorial.org/book/modeling_users">railstutorial.org</a></td>
	</tr>
	<tr>
	  	<td><code>/\A[^@\s]+@([^@.\s]+\.)+[^@.\s]+\z/i</code></td>
	  	<td>3</td>
	  	<td>10</td>
	  	<td><a href="http://stackoverflow.com/questions/4770133/rails-regex-for-email-validation">stackoverflow.com</a></td>
	</tr>
	<tr>
	  	<td><code>/\A[^@\s]+@([^@.\s]+\.)*[^@.\s]+\z/i</code></td>
	  	<td>3</td>
	  	<td>11</td>
	  	<td><a href="http://stackoverflow.com/questions/4770133/rails-regex-for-email-validation">stackoverflow.com</a></td>
	</tr>
	<tr>
	  	<td><code>/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i</code></td>
	  	<td>7</td>
	  	<td>7</td>
	  	<td><a href="http://stackoverflow.com/questions/4770133/rails-regex-for-email-validation">stackoverflow.com</a></td>
	</tr>
	<tr>
	  	<td><code>/\A(\S+)@(.+)\.(\S+)\z/i</code></td>
	  	<td>1</td>
	  	<td>13</td>
	  	<td><a href="http://stackoverflow.com/questions/4770133/rails-regex-for-email-validation">stackoverflow.com</a></td>
	</tr>
</table><p> </p><p>The important thing to take away from these results is that <em>none of these regular expressions are very good at both accepting valid emails and rejecting invalid ones</em>. And since I think it's much worse to reject a valid emails than to accept an invalid one, that just leaves us with one of the first two. i.e. the simplest ones on the list.</p><p>In fact, it's probably better to validate email on the client side, but still allow the user to submit the email even if your validation thinks it's invalid (maybe with minimal server-side validation such as /@/). That way you can give them a helpful hint if it looks like they've entered an invalid email, but still allow the people with unusual emails to submit them.</p><p>Here are some related links:</p><ul><li><a href="https://fightingforalostcause.net/content/misc/2006/compare-email-regex.php">Comparing E-mail Address Validating Regular Expressions</a></li><li><a href="http://ex-parrot.com/~pdw/Mail-RFC822-Address.html">An RFC compliant regular expression for validating emails</a></li><li><a href="http://davidcel.is/blog/2012/09/06/stop-validating-email-addresses-with-regex/">Stop validating emails with complicated regular expressions</a></li><li><a href="http://codefool.tumblr.com/post/15288874550/list-of-valid-and-invalid-email-addresses">A list of valid and invalid email addresses</a></li><li><a href="http://stackoverflow.com/questions/4770133/rails-regex-for-email-validation">StackOverflow discussion on validating emails in rails</a></li><li><a href="https://fightingforalostcause.net/content/misc/2006/compare-email-regex.php">Comparing E-mail Address Validating Regular Expressions</a></li></ul>

        </div>
        <!-- .entry-content -->


    </article>
    <!-- .hentry -->

    <!-- .nav-single -->
    <nav class="nav-single row-fluid">
        
        <div class="nav-previous span6">
            <h4>PREVIOUS POST</h4>
            <a href="/posts/getting-started-with-emacs-for-clojure-development" rel="prev"><span class="meta-nav">←</span> Getting started with emacs for clojure development</a>
        </div>
        

        
        <div class="nav-next span6">
            <h4>NEXT POST</h4>
            <a href="/posts/favourite-programming-books" rel="next">Seven of my favourite programming books <span class="meta-nav">→</span></a>
        </div>
        

    </nav>
    <!-- .nav-single -->

</div>
<!-- .blog-single -->


<!-- InstanceEndEditable -->
                    </div>
                    <!-- #content -->

                </div>
                <!-- #primary -->





         </div>
      </section>
      <!-- #main -->





          <!-- .site-footer -->
      <footer class="site-footer wrapper" role="contentinfo">
        <!-- .row -->
        <div class="row">


          <!-- #supplementary -->
          <div id="supplementary" class="row-fluid">


            <!-- .widget-area -->
            <!--<div class="widget-area span3" role="complementary">

              <aside class="widget widget_text">
                <h3 class="widget-title">About Read</h3>
                <div class="textwidget">Read is a minimalistic wordpress theme focused on readability. This is a just text widget with some dummy content. This is a just text widget with some dummy content. This is a just text widget with some dummy content.</div>
              </aside>

            </div>-->
            <!-- .widget-area -->


            <!-- .widget-area -->
            <!--<div class="widget-area span3" role="complementary">

              <aside class="widget widget_recent_entries">
                  <h3 class="widget-title">Recent Posts</h3>
                  <ul>
                    <li><a href="#" title="Thinking About Responsive Design">Thinking About Responsive Design</a></li>
                    <li><a href="#" title="Adaptive Vs. Responsive Layouts And Optimal Form Field Labels">Adaptive Vs. Responsive Layouts And Optimal Form Field Labels</a></li>
                    <li><a href="#" title="Hello world!">Hello world!</a></li>
                  </ul>
                </aside>

            </div>-->
            <!-- .widget-area -->

            <!-- .widget-area -->
            <!--<div class="widget-area span3" role="complementary">

              <aside class="widget widget-instagram">
                  <h3 class="widget-title">Photos on Instagram</h3>
                  <div class="instagram"></div>
                  <script src="../js/instagram.js"></script>
                </aside>

            </div>-->
            <!-- .widget-area -->

            <!-- .widget-area -->
            <!--<div class="widget-area span3" role="complementary">

              <aside class="widget widget_categories">
                  <h3 class="widget-title">Categories</h3>
                  <ul>
                    <li><a href="#" title="View all posts filed under Uncategorized">Web Design</a></li>
                    <li><a href="#" title="View all posts filed under Uncategorized">Javascript</a></li>
                    <li><a href="#" title="View all posts filed under Uncategorized">Typography</a></li>
                    <li><a href="#" title="View all posts filed under Uncategorized">Freebies</a></li>
                  </ul>
                </aside>

            </div>-->
            <!-- .widget-area -->


          </div>
          <!-- #supplementary -->


          <!-- .site-info -->
          <div class="site-info">(c) Aidan Finn</div>
          <!-- .site-info -->

        </div>
        <!-- .row -->
      </footer>
      <!-- .site-footer -->

    </div>
    <!-- #PAGE -->




    <!-- SCRIPTS -->
    <script src="/js/detectmobilebrowser.js"></script>
    <script src="/js/modernizr.js"></script>
    <script src="/js/jquery.imagesloaded.min.js"></script>
    <script src="/js/jquery.fitvids.js"></script>
    <script src="/js/jquery.uniform.min.js"></script>

    <!-- InstanceBeginEditable name="body-end" -->
    <script src="/js/jquery.validate.min.js"></script>
	<!-- InstanceEndEditable -->

    <script src="/js/main.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-539512-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
<!-- InstanceEnd --></html>
